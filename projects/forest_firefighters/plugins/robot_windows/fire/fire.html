<html>

<head> 
</head>

<body>
  <h1>Wind direction:</h1>
  <canvas id="canvas" width="400" height="400"
    style="background-color:black">
  </canvas>
  <h1>Wind speed:</h1>
  <h1 id="speed"></h1>


  <script>

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var radius = canvas.height / 2;
    ctx.translate(radius, radius);
    radius = radius * 0.90

    window.onload = function() {
      window.robotWindow = webots.window();
      window.robotWindow.setTitle('Custom HTML robot window');
      window.robotWindow.receive = receive;
    };

    function receive(message) {
      wind = JSON.parse(message)
      document.getElementById('speed').innerHTML = wind.speed;
      drawWindIndicator(wind)
    }

    

    function drawWindIndicator(message) {
      drawFace(ctx, radius);
      displayWind(ctx, radius, wind);
    }

    function drawFace(ctx, radius) {
      var grad;
      ctx.beginPath();
      ctx.arc(0, 0, radius, 0, 2*Math.PI);
      ctx.fillStyle = 'white';
      ctx.fill();
      grad = ctx.createRadialGradient(0,0,radius*0.95, 0,0,radius*1.05);
      grad.addColorStop(0, 'black');
      grad.addColorStop(0.5, 'white');
      grad.addColorStop(1, 'black');
      ctx.strokeStyle = grad;
      ctx.lineWidth = radius*0.1;
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(0, 0, radius*0.1, 0, 2*Math.PI);
      ctx.fillStyle = 'black';
      ctx.fill();
    }

    function displayWind(ctx, radius, wind){
      angle = wind.angle + Math.PI/2
      ctx.beginPath();
      ctx.lineWidth = radius*0.02;
      ctx.lineCap = "round";
      ctx.moveTo(0,0);
      ctx.rotate(angle);
      ctx.lineTo(0, -radius*0.9);
      ctx.stroke();
      ctx.rotate(-angle);
    }      
  </script>
</body>

</html>